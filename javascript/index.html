<!DOCTYPE html>
<html lang="ja" ng-app="myApp">
<html>
  <head>
    <meta charset="utf-8">
    <title>Edit Package Report Search</title>
  </head>
  <style type="text/css">

  </style>
  <body>
    <h1>Edit Package Report Search</h1>
    下記の条件を設定し、「実行」ボタンを押下してください。
      <div ng-controller="mainCtrl">
        <section>
          <p>
            <label for="report">閲覧するレポートを選択してください：</label>
            <select ng-model="report" ng-change="change()">
              <option value="">ファイル選択なし</option>
              <option value="EP-100">EP-100</option>
              <option value="EP-101">EP-101</option>
              <option value="EP-102">EP-102</option>
              <option value="EP-103">EP-103</option>
            </select>
          </p>
          <p>
            <label for="date">日付を選択してください：</label>
            <input type="date" ng-model="date" ng-change="change()">
          </p>
          <p>
            <!--
            <button ng-click="ontheclick()">実行</button>
          -->
          </p>
        </section>
            <li ng-repeat="file in fileList | filter:report | filter:date" ng-class="$odd ? 'bg-success' : 'bg-warning'" ng-controller="describe">
              <p>{{fileList.length}}件のファイルが見つかりました。</p>
              <table>
                <tr>
                  <th>ファイル名</th>
                  <th>更新日時</th>
                  <th>テキスト</th>
                </tr>
                <tr>
                  <td>{{file.name}}</td>
                  <td>{{file.date | date : 'yyyy年MM月dd日'}}</td>
                  <td ng-click="onclick()">表示</td>
                  {{text}}
              </table>
            </li>
      </div>
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.4/angular.min.js"></script>
  <script type="text/javascript">
  var app = angular.module('myApp', []);
    app.controller('mainCtrl', function($scope, $http) {
      $scope.change = function(){ //$scope.ontheclickにするのもあり
        $http.jsonp('http://api.openweathermap.org/data/2.5/weather',{
          param:{
            callback: 'JSON_CALLBACK',
            fileName: $scope.report,
            fileDate: $scope.date
          }
        })
        .success(function(data) {
          $scope.fileList = data;
        })
        .error(function(err){
          console.log("失敗");
          console.log(err);
        });
      };
  });
  app.controller('describe', function($scope) {
    $scope.onclick = function(){
      $scope.text = $scope.file.text
    };
  });
  </script>
</html>
